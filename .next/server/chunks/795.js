exports.id=795,exports.ids=[795],exports.modules={7032:()=>{},408:()=>{},3418:(e,t,r)=>{"use strict";r.d(t,{T:()=>d});var n=r(6037);let i=process.env.MONGODB_URI||"mongodb://localhost:27017/GalaTech";if(console.log(i,"ini MONGODB_URI"),!i)throw Error("Please define the MONGODB_URI env var in .env.local");let a=global.mongoose;async function d(){return a.conn||(a.promise||(a.promise=n.connect(i,{bufferCommands:!1,dbName:process.env.MONGODB_DB,maxPoolSize:10}).then(e=>e)),a.conn=await a.promise),a.conn}a||(a=global.mongoose={conn:null,promise:null})},9999:(e,t,r)=>{"use strict";r.d(t,{mz:()=>u,Z3:()=>b,b7:()=>o,rI:()=>g,pH:()=>N,p2:()=>O,Yt:()=>y,p_:()=>A,KJ:()=>d,ar:()=>D});var n=r(6037);let i=new n.Schema({label:String,receiver_name:String,phone:String,street:String,subdistrict:String,city:String,province:String,postal_code:String,country:{type:String,default:"ID"},is_default:{type:Boolean,default:!1},geo:{lat:Number,lng:Number}},{_id:!0}),a=new n.Schema({email:{type:String,index:!0,unique:!0,sparse:!0},phone:{type:String,index:!0,unique:!0,sparse:!0},name:String,password_hash:String,roles:{type:[String],default:["customer"]},status:{type:String,enum:["active","blocked","deleted"],default:"active"},default_address_id:{type:n.Schema.Types.ObjectId},addresses:[i]},{timestamps:!0}),d=n.models.User||n.model("User",a),s=new n.Schema({slug:{type:String,unique:!0,index:!0},name:{type:String,required:!0},logo_url:String,logo_public_id:{type:String,default:""},country:String,status:{type:String,enum:["active","inactive"],default:"active"}},{timestamps:!0});s.index({name:"text"});let u=n.models.Brand||n.model("Brand",s),p=new n.Schema({slug:{type:String,unique:!0,index:!0},name:{type:String,required:!0},image:{type:String,required:!0},parent_id:{type:n.Schema.Types.ObjectId,ref:"Category",default:null},ancestors:[{_id:{type:n.Schema.Types.ObjectId,ref:"Category"},name:String,slug:String}],order:{type:Number,default:0}},{timestamps:!0});p.index({parent_id:1,order:1});let o=n.models.Category||n.model("Category",p),m=new n.Schema({url:String,alt:String},{_id:!1}),c=new n.Schema({sku:{type:String,index:!0,unique:!0},options:{type:n.Schema.Types.Mixed},price:{currency:{type:String,default:"IDR"},list:{type:Number,required:!0},sale:{type:Number,default:null},startAt:Date,endAt:Date},weightGram:Number,dimensionsCm:{l:Number,w:Number,h:Number},barcode:String,status:{type:String,enum:["active","inactive"],default:"active"}},{_id:!0}),l=new n.Schema({slug:{type:String,unique:!0,index:!0},sku:String,title:{type:String,required:!0},subtitle:String,brandId:{type:n.Schema.Types.ObjectId,ref:"Brand"},categoryIds:[{type:n.Schema.Types.ObjectId,ref:"Category"}],descriptionHtml:String,media:[m],attributes:n.Schema.Types.Mixed,variants:{type:[c],validate:e=>e.length>0},seo:{title:String,metaDescription:String},status:{type:String,enum:["active","draft","archived"],default:"active"},rating:{avg:{type:Number,default:0},count:{type:Number,default:0}},soldCount:{type:Number,default:0},viewCount:{type:Number,default:0}},{timestamps:!0});l.index({title:"text"}),l.index({brandId:1}),l.index({categoryIds:1}),l.index({status:1}),l.index({updatedAt:-1});let y=n.models.Product||(0,n.model)("Product",l),S=new n.Schema({product_id:{type:n.Schema.Types.ObjectId,ref:"Product",index:!0},variant_id:{type:n.Schema.Types.ObjectId,index:!0},warehouse_id:{type:String,default:"JKT-01"},on_hand:{type:Number,default:0},reserved:{type:Number,default:0}},{timestamps:!0});S.index({product_id:1,variant_id:1,warehouse_id:1},{unique:!0});let g=n.models.Inventory||n.model("Inventory",S),h=new n.Schema({productId:{type:n.Schema.Types.ObjectId,ref:"Product"},variantId:{type:n.Schema.Types.ObjectId},sku:String,title:String,variantLabel:String,qty:{type:Number,default:1},priceSnapshot:{currency:String,unit:Number},addedAt:{type:Date,default:Date.now}},{_id:!0}),f=new n.Schema({userId:{type:n.Schema.Types.ObjectId,ref:"User",index:!0},sessionId:{type:String,index:!0},items:[h],couponCodes:[String],notes:String},{timestamps:!0}),b=n.models.Cart||(0,n.model)("Cart",f),I=new n.Schema({productId:{type:n.Schema.Types.ObjectId,ref:"Product"},variantId:{type:n.Schema.Types.ObjectId},sku:String,title:String,variantLabel:String,qty:{type:Number,required:!0},price:{currency:{type:String,default:"IDR"},unit:{type:Number,required:!0},subtotal:{type:Number,required:!0}},weightGram:Number},{_id:!0}),v=new n.Schema({receiverName:String,phone:String,street:String,subdistrict:String,city:String,province:String,postalCode:String,country:String},{_id:!1}),x=new n.Schema({orderNo:{type:String,unique:!0,index:!0},userId:{type:n.Schema.Types.ObjectId,ref:"User",index:!0},status:{type:String,enum:["awaiting_payment","paid","processing","shipped","completed","cancelled","refunded"],default:"awaiting_payment"},channel:{type:String,default:"web"},items:[I],pricing:{subtotal:Number,discounts:[{code:String,amount:Number}],shippingCost:Number,tax:Number,grandTotal:Number},shippingAddress:v,billingAddress:v,payment:{paymentId:{type:n.Schema.Types.ObjectId,ref:"Payment"},method:String,status:{type:String,enum:["pending","paid","failed","expired"],default:"pending"}},shipment:{shipmentId:{type:n.Schema.Types.ObjectId,ref:"Shipment"},courier:String,service:String,trackingNo:String},placedAt:{type:Date,default:Date.now}},{timestamps:!0});x.index({userId:1,placedAt:-1}),x.index({status:1,placedAt:-1});let N=n.models.Order||(0,n.model)("Order",x),w=new n.Schema({orderId:{type:n.Schema.Types.ObjectId,ref:"Order",unique:!0},provider:String,method:String,amount:Number,currency:{type:String,default:"IDR"},status:{type:String,enum:["pending","paid","failed","expired","refunded"],default:"pending"},externalRef:{type:String,index:!0},vaNumber:String,paidAt:Date,raw:n.Schema.Types.Mixed},{timestamps:!0});w.index({status:1,createdAt:-1});let O=n.models.Payment||(0,n.model)("Payment",w),T=new n.Schema({status:String,at:Date},{_id:!1}),_=new n.Schema({orderId:{type:n.Schema.Types.ObjectId,ref:"Order",unique:!0},warehouseId:{type:String,default:"MAIN"},courier:String,service:String,trackingNo:{type:String,unique:!0,sparse:!0},status:{type:String,enum:["packed","shipped","in_transit","delivered","failed"],default:"packed"},history:[T]},{timestamps:!0});n.models.Shipment||(0,n.model)("Shipment",_);let j=new n.Schema({product_id:{type:n.Schema.Types.ObjectId,ref:"Product",index:!0},variant_id:{type:n.Schema.Types.ObjectId},order_id:{type:n.Schema.Types.ObjectId,ref:"Order"},user_id:{type:n.Schema.Types.ObjectId,ref:"User"},rating:{type:Number,min:1,max:5},title:String,content:String,media:[{url:String}],helpful_count:{type:Number,default:0},status:{type:String,enum:["pending","published","rejected"],default:"pending"}},{timestamps:!0});j.index({status:1,createdAt:-1});let A=n.models.Review||n.model("Review",j),q=new n.Schema({userId:{type:n.Schema.Types.ObjectId,ref:"User",unique:!0},items:[{productId:{type:n.Schema.Types.ObjectId,ref:"Product"},addedAt:{type:Date,default:Date.now}}]},{timestamps:!0}),D=n.models.Wishlist||(0,n.model)("Wishlist",q),C=new n.Schema({code:{type:String,unique:!0,index:!0},type:{type:String,enum:["flat","percent","shipping","bundle"],default:"flat"},value:Number,minOrder:{type:Number,default:0},maxDiscount:{type:Number,default:null},startAt:Date,endAt:Date,usageLimit:Number,usageCount:{type:Number,default:0},constraints:{brandIds:[n.Schema.Types.ObjectId],categoryIds:[n.Schema.Types.ObjectId],firstOrderOnly:{type:Boolean,default:!1}},status:{type:String,enum:["active","inactive"],default:"active"}},{timestamps:!0});C.index({status:1,startAt:1,endAt:1}),n.models.Coupon||(0,n.model)("Coupon",C);let R=new n.Schema({slot:{type:String,index:!0},title:String,imageUrl:String,linkUrl:String,startAt:Date,endAt:Date,priority:{type:Number,default:0},status:{type:String,enum:["active","inactive"],default:"active"}},{timestamps:!0});R.index({slot:1,status:1,startAt:1,endAt:1}),n.models.Banner||(0,n.model)("Banner",R);let E=new n.Schema({type:{type:String,index:!0},ref:{type:n.Schema.Types.Mixed},userId:{type:n.Schema.Types.ObjectId,ref:"User"},meta:n.Schema.Types.Mixed},{timestamps:{createdAt:!0,updatedAt:!1}});E.index({"ref.orderId":1,createdAt:-1}),E.index({createdAt:-1}),n.models.Event||(0,n.model)("Event",E);let k=new n.Schema({orderItemSku:String,qty:Number,reason:String},{_id:!1}),P=new n.Schema({orderId:{type:n.Schema.Types.ObjectId,ref:"Order"},items:[k],status:{type:String,enum:["requested","approved","rejected","received","refunded"],default:"requested"},refund:{amount:Number,method:{type:String,default:"original"}}},{timestamps:!0});n.models.Return||(0,n.model)("Return",P)},9902:(e,t,r)=>{"use strict";r.d(t,{B:()=>a,E:()=>i});var n=r(8483);async function i(e){if(!e||"string"!=typeof e)throw Error("Invalid password");let t=await n.Ay.genSalt(10);return n.Ay.hash(e,t)}async function a(e,t){return!!e&&!!t&&n.Ay.compare(e,t)}},3947:(e,t,r)=>{"use strict";r.d(t,{D_:()=>d,Pq:()=>p,hS:()=>o,m_:()=>u,qQ:()=>s,v7:()=>a});var n=r(3022);class i extends Error{constructor(e,t=500,r){super(e),this.name=this.constructor.name,this.status=t,this.details=r}}class a extends i{constructor(e="Bad Request",t){super(e,400,t)}}class d extends i{constructor(e="Unauthorized",t){super(e,401,t)}}class s extends i{constructor(e="Forbidden",t){super(e,403,t)}}class u extends i{constructor(e="Not Found",t){super(e,404,t)}}function p(e,t={}){let r=t.status||200,n=new Headers(t.headers||void 0);return n.has("Content-Type")||n.set("Content-Type","application/json"),new Response(JSON.stringify(e),{status:r,headers:n})}function o(e){if(e instanceof n.G){let t=e instanceof n.G?new a("Validation error",e.issues.map(e=>({path:e.path.join("."),message:e.message,code:e.code}))):e;return p({error:t.message,details:t.details},{status:t.status})}return e instanceof i?p({error:e.message,details:e.details},{status:e.status}):e?.name==="JsonWebTokenError"?p({error:"Invalid token"},{status:401}):e?.name==="TokenExpiredError"?p({error:"Token expired"},{status:401}):(console.error("[API ERROR]",e),p({error:"Internal Server Error"},{status:500}))}},2171:(e,t,r)=>{"use strict";r.d(t,{nr:()=>s,zF:()=>d});var n=r(365);let i=process.env.JWT_SECRET,a=process.env.JWT_EXPIRES_IN||"7d";function d(e,t={}){return n.sign(e,i,{expiresIn:t.expiresIn||a})}function s(e){return n.verify(e,i)}i||console.warn("JWT_SECRET is not set. Set it in .env.local")}};