"use strict";(()=>{var e={};e.id=413,e.ids=[413],e.modules={6037:e=>{e.exports=require("mongoose")},846:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},4870:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},9294:e=>{e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},3033:e=>{e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},9428:e=>{e.exports=require("buffer")},5511:e=>{e.exports=require("crypto")},7910:e=>{e.exports=require("stream")},8354:e=>{e.exports=require("util")},3704:(e,r,t)=>{t.r(r),t.d(r,{patchFetch:()=>v,routeModule:()=>w,serverHooks:()=>h,workAsyncStorage:()=>m,workUnitAsyncStorage:()=>x});var a={};t.r(a),t.d(a,{GET:()=>l,PATCH:()=>k,runtime:()=>c});var i=t(1271),s=t(1232),n=t(8079),o=t(3418),d=t(9999),u=t(3947),p=t(7001);let c="nodejs";async function l(e,{params:r}){try{await (0,o.T)();let e=(0,p.JR)(),t=await d.pH.findById(r.id).lean();if(!t)throw new u.v7("Order tidak ditemukan");if(String(t.userId)!==String(e.sub))throw new u.D_("Tidak boleh akses order orang lain");return(0,u.Pq)({item:t})}catch(e){return(0,u.hS)(e)}}async function k(e,{params:r}){try{await (0,o.T)();let t=(0,p.JR)(),a=await e.json(),i=await d.pH.findById(r.id);if(!i)throw new u.v7("Order tidak ditemukan");if(String(i.userId)!==String(t.sub))throw new u.D_("Tidak boleh akses order orang lain");if(a?.action==="cancel"){if("awaiting_payment"!==i.status)throw new u.v7("Order tidak bisa dibatalkan");return i.status="cancelled",await i.save(),Array.isArray(i.items)&&await Promise.all(i.items.map(e=>d.rI.updateOne({product_id:e.productId,variant_id:e.variantId,sku:e.sku,warehouse:"main"},{$inc:{qty:e.qty}}))),(0,u.Pq)({item:{_id:i._id,status:i.status}})}return(0,u.Pq)({error:"Aksi tidak dikenali"},{status:400})}catch(e){return(0,u.hS)(e)}}let w=new i.AppRouteRouteModule({definition:{kind:s.RouteKind.APP_ROUTE,page:"/api/orders/[id]/route",pathname:"/api/orders/[id]",filename:"route",bundlePath:"app/api/orders/[id]/route"},resolvedPagePath:"C:\\Users\\imamb\\Desktop\\QuickCart\\apps\\backend\\app\\api\\orders\\[id]\\route.js",nextConfigOutput:"",userland:a}),{workAsyncStorage:m,workUnitAsyncStorage:x,serverHooks:h}=w;function v(){return(0,n.patchFetch)({workAsyncStorage:m,workUnitAsyncStorage:x})}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[79,388,365,255,501],()=>t(3704));module.exports=a})();