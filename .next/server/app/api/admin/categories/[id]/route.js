(()=>{var e={};e.id=480,e.ids=[480],e.modules={6037:e=>{"use strict";e.exports=require("mongoose")},846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},4870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},9428:e=>{"use strict";e.exports=require("buffer")},5511:e=>{"use strict";e.exports=require("crypto")},7910:e=>{"use strict";e.exports=require("stream")},8354:e=>{"use strict";e.exports=require("util")},7588:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>b,routeModule:()=>y,serverHooks:()=>f,workAsyncStorage:()=>S,workUnitAsyncStorage:()=>h});var i={};r.r(i),r.d(i,{DELETE:()=>g,GET:()=>m,PATCH:()=>l,runtime:()=>c});var n=r(1271),a=r(1232),s=r(8079),d=r(3418),u=r(9999),o=r(3947),p=r(5642);let c="nodejs";async function m(e,{params:t}){try{await (0,d.T)(),(0,p.ZT)();let e=await u.b7.findById(t.id).lean();if(!e)throw new o.v7("Kategori tidak ditemukan");return(0,o.Pq)({item:e})}catch(e){return(0,o.hS)(e)}}async function l(e,{params:t}){try{await (0,d.T)(),(0,p.ZT)();let r=await e.json(),i=await u.b7.findById(t.id);if(!i)throw new o.v7("Kategori tidak ditemukan");if(void 0!==r.name&&(i.name=r.name),void 0!==r.slug&&(i.slug=r.slug||function(e=""){return e.toLowerCase().trim().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-")}(i.name)),void 0!==r.order&&(i.order=Number(r.order)||0),void 0!==r.image){let e="string"==typeof r.image?r.image:Array.isArray(r.image)?"string"==typeof r.image[0]?r.image[0]:r.image[0]?.url:r.image?.url||"";i.image=e}if(void 0!==r.parent_id){let e=null,t=[];if(r.parent_id){if(!(e=await u.b7.findById(r.parent_id).lean()))throw new o.v7("Parent tidak ditemukan");t=[...e.ancestors||[],{_id:e._id,name:e.name,slug:e.slug}]}i.parent_id=e?e._id:null,i.ancestors=t}return await i.save(),(0,o.Pq)({item:{_id:i._id}})}catch(e){if(e?.code===11e3&&e?.keyPattern?.slug)return(0,o.Pq)({error:"Slug sudah dipakai"},{status:400});return(0,o.hS)(e)}}async function g(e,{params:t}){try{if(await (0,d.T)(),(0,p.ZT)(),await u.b7.exists({parent_id:t.id}))return(0,o.Pq)({error:"Masih ada subkategori. Hapus/relokasi dulu."},{status:400});return await u.b7.findByIdAndDelete(t.id),(0,o.Pq)({ok:!0})}catch(e){return(0,o.hS)(e)}}let y=new n.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/admin/categories/[id]/route",pathname:"/api/admin/categories/[id]",filename:"route",bundlePath:"app/api/admin/categories/[id]/route"},resolvedPagePath:"C:\\Users\\imamb\\Desktop\\QuickCart\\apps\\backend\\app\\api\\admin\\categories\\[id]\\route.js",nextConfigOutput:"",userland:i}),{workAsyncStorage:S,workUnitAsyncStorage:h,serverHooks:f}=y;function b(){return(0,s.patchFetch)({workAsyncStorage:S,workUnitAsyncStorage:h})}},7032:()=>{},408:()=>{},5642:(e,t,r)=>{"use strict";r.d(t,{JR:()=>d,ZT:()=>u});var i=r(255),n=r(2171),a=r(3947);async function s(){let e=await (0,i.UL)(),t=e.get("gt_auth")?.value;if(!t)throw new a.D_("Unauthorized");return(0,n.nr)(t)}async function d(){let e=await s();if(!e?.sub)throw new a.D_("Unauthorized");return e}async function u(){let e=await d();if(!(Array.isArray(e?.roles)?e.roles:[]).includes("admin"))throw new a.qQ("Forbidden");return e}},3418:(e,t,r)=>{"use strict";r.d(t,{T:()=>s});var i=r(6037);let n=process.env.MONGODB_URI||"mongodb://localhost:27017/GalaTech";if(console.log(n,"ini MONGODB_URI"),!n)throw Error("Please define the MONGODB_URI env var in .env.local");let a=global.mongoose;async function s(){return a.conn||(a.promise||(a.promise=i.connect(n,{bufferCommands:!1,dbName:process.env.MONGODB_DB,maxPoolSize:10}).then(e=>e)),a.conn=await a.promise),a.conn}a||(a=global.mongoose={conn:null,promise:null})},9999:(e,t,r)=>{"use strict";r.d(t,{mz:()=>u,Z3:()=>b,b7:()=>p,rI:()=>S,pH:()=>I,p2:()=>T,Yt:()=>g,p_:()=>j,KJ:()=>s,ar:()=>A});var i=r(6037);let n=new i.Schema({label:String,receiver_name:String,phone:String,street:String,subdistrict:String,city:String,province:String,postal_code:String,country:{type:String,default:"ID"},is_default:{type:Boolean,default:!1},geo:{lat:Number,lng:Number}},{_id:!0}),a=new i.Schema({email:{type:String,index:!0,unique:!0,sparse:!0},phone:{type:String,index:!0,unique:!0,sparse:!0},name:String,password_hash:String,roles:{type:[String],default:["customer"]},status:{type:String,enum:["active","blocked","deleted"],default:"active"},default_address_id:{type:i.Schema.Types.ObjectId},addresses:[n]},{timestamps:!0}),s=i.models.User||i.model("User",a),d=new i.Schema({slug:{type:String,unique:!0,index:!0},name:{type:String,required:!0},logo_url:String,logo_public_id:{type:String,default:""},country:String,status:{type:String,enum:["active","inactive"],default:"active"}},{timestamps:!0});d.index({name:"text"});let u=i.models.Brand||i.model("Brand",d),o=new i.Schema({slug:{type:String,unique:!0,index:!0},name:{type:String,required:!0},image:{type:String,required:!0},parent_id:{type:i.Schema.Types.ObjectId,ref:"Category",default:null},ancestors:[{_id:{type:i.Schema.Types.ObjectId,ref:"Category"},name:String,slug:String}],order:{type:Number,default:0}},{timestamps:!0});o.index({parent_id:1,order:1});let p=i.models.Category||i.model("Category",o),c=new i.Schema({url:String,alt:String},{_id:!1}),m=new i.Schema({sku:{type:String,index:!0,unique:!0},options:{type:i.Schema.Types.Mixed},price:{currency:{type:String,default:"IDR"},list:{type:Number,required:!0},sale:{type:Number,default:null},startAt:Date,endAt:Date},weightGram:Number,dimensionsCm:{l:Number,w:Number,h:Number},barcode:String,status:{type:String,enum:["active","inactive"],default:"active"}},{_id:!0}),l=new i.Schema({slug:{type:String,unique:!0,index:!0},sku:String,title:{type:String,required:!0},subtitle:String,brandId:{type:i.Schema.Types.ObjectId,ref:"Brand"},categoryIds:[{type:i.Schema.Types.ObjectId,ref:"Category"}],descriptionHtml:String,media:[c],attributes:i.Schema.Types.Mixed,variants:{type:[m],validate:e=>e.length>0},seo:{title:String,metaDescription:String},status:{type:String,enum:["active","draft","archived"],default:"active"},rating:{avg:{type:Number,default:0},count:{type:Number,default:0}},soldCount:{type:Number,default:0},viewCount:{type:Number,default:0}},{timestamps:!0});l.index({title:"text"}),l.index({brandId:1}),l.index({categoryIds:1}),l.index({status:1}),l.index({updatedAt:-1});let g=i.models.Product||(0,i.model)("Product",l),y=new i.Schema({product_id:{type:i.Schema.Types.ObjectId,ref:"Product",index:!0},variant_id:{type:i.Schema.Types.ObjectId,index:!0},warehouse_id:{type:String,default:"JKT-01"},on_hand:{type:Number,default:0},reserved:{type:Number,default:0}},{timestamps:!0});y.index({product_id:1,variant_id:1,warehouse_id:1},{unique:!0});let S=i.models.Inventory||i.model("Inventory",y),h=new i.Schema({productId:{type:i.Schema.Types.ObjectId,ref:"Product"},variantId:{type:i.Schema.Types.ObjectId},sku:String,title:String,variantLabel:String,qty:{type:Number,default:1},priceSnapshot:{currency:String,unit:Number},addedAt:{type:Date,default:Date.now}},{_id:!0}),f=new i.Schema({userId:{type:i.Schema.Types.ObjectId,ref:"User",index:!0},sessionId:{type:String,index:!0},items:[h],couponCodes:[String],notes:String},{timestamps:!0}),b=i.models.Cart||(0,i.model)("Cart",f),v=new i.Schema({productId:{type:i.Schema.Types.ObjectId,ref:"Product"},variantId:{type:i.Schema.Types.ObjectId},sku:String,title:String,variantLabel:String,qty:{type:Number,required:!0},price:{currency:{type:String,default:"IDR"},unit:{type:Number,required:!0},subtotal:{type:Number,required:!0}},weightGram:Number},{_id:!0}),x=new i.Schema({receiverName:String,phone:String,street:String,subdistrict:String,city:String,province:String,postalCode:String,country:String},{_id:!1}),w=new i.Schema({orderNo:{type:String,unique:!0,index:!0},userId:{type:i.Schema.Types.ObjectId,ref:"User",index:!0},status:{type:String,enum:["awaiting_payment","paid","processing","shipped","completed","cancelled","refunded"],default:"awaiting_payment"},channel:{type:String,default:"web"},items:[v],pricing:{subtotal:Number,discounts:[{code:String,amount:Number}],shippingCost:Number,tax:Number,grandTotal:Number},shippingAddress:x,billingAddress:x,payment:{paymentId:{type:i.Schema.Types.ObjectId,ref:"Payment"},method:String,status:{type:String,enum:["pending","paid","failed","expired"],default:"pending"}},shipment:{shipmentId:{type:i.Schema.Types.ObjectId,ref:"Shipment"},courier:String,service:String,trackingNo:String},placedAt:{type:Date,default:Date.now}},{timestamps:!0});w.index({userId:1,placedAt:-1}),w.index({status:1,placedAt:-1});let I=i.models.Order||(0,i.model)("Order",w),_=new i.Schema({orderId:{type:i.Schema.Types.ObjectId,ref:"Order",unique:!0},provider:String,method:String,amount:Number,currency:{type:String,default:"IDR"},status:{type:String,enum:["pending","paid","failed","expired","refunded"],default:"pending"},externalRef:{type:String,index:!0},vaNumber:String,paidAt:Date,raw:i.Schema.Types.Mixed},{timestamps:!0});_.index({status:1,createdAt:-1});let T=i.models.Payment||(0,i.model)("Payment",_),N=new i.Schema({status:String,at:Date},{_id:!1}),O=new i.Schema({orderId:{type:i.Schema.Types.ObjectId,ref:"Order",unique:!0},warehouseId:{type:String,default:"MAIN"},courier:String,service:String,trackingNo:{type:String,unique:!0,sparse:!0},status:{type:String,enum:["packed","shipped","in_transit","delivered","failed"],default:"packed"},history:[N]},{timestamps:!0});i.models.Shipment||(0,i.model)("Shipment",O);let q=new i.Schema({product_id:{type:i.Schema.Types.ObjectId,ref:"Product",index:!0},variant_id:{type:i.Schema.Types.ObjectId},order_id:{type:i.Schema.Types.ObjectId,ref:"Order"},user_id:{type:i.Schema.Types.ObjectId,ref:"User"},rating:{type:Number,min:1,max:5},title:String,content:String,media:[{url:String}],helpful_count:{type:Number,default:0},status:{type:String,enum:["pending","published","rejected"],default:"pending"}},{timestamps:!0});q.index({status:1,createdAt:-1});let j=i.models.Review||i.model("Review",q),k=new i.Schema({userId:{type:i.Schema.Types.ObjectId,ref:"User",unique:!0},items:[{productId:{type:i.Schema.Types.ObjectId,ref:"Product"},addedAt:{type:Date,default:Date.now}}]},{timestamps:!0}),A=i.models.Wishlist||(0,i.model)("Wishlist",k),D=new i.Schema({code:{type:String,unique:!0,index:!0},type:{type:String,enum:["flat","percent","shipping","bundle"],default:"flat"},value:Number,minOrder:{type:Number,default:0},maxDiscount:{type:Number,default:null},startAt:Date,endAt:Date,usageLimit:Number,usageCount:{type:Number,default:0},constraints:{brandIds:[i.Schema.Types.ObjectId],categoryIds:[i.Schema.Types.ObjectId],firstOrderOnly:{type:Boolean,default:!1}},status:{type:String,enum:["active","inactive"],default:"active"}},{timestamps:!0});D.index({status:1,startAt:1,endAt:1}),i.models.Coupon||(0,i.model)("Coupon",D);let P=new i.Schema({slot:{type:String,index:!0},title:String,imageUrl:String,linkUrl:String,startAt:Date,endAt:Date,priority:{type:Number,default:0},status:{type:String,enum:["active","inactive"],default:"active"}},{timestamps:!0});P.index({slot:1,status:1,startAt:1,endAt:1}),i.models.Banner||(0,i.model)("Banner",P);let C=new i.Schema({type:{type:String,index:!0},ref:{type:i.Schema.Types.Mixed},userId:{type:i.Schema.Types.ObjectId,ref:"User"},meta:i.Schema.Types.Mixed},{timestamps:{createdAt:!0,updatedAt:!1}});C.index({"ref.orderId":1,createdAt:-1}),C.index({createdAt:-1}),i.models.Event||(0,i.model)("Event",C);let R=new i.Schema({orderItemSku:String,qty:Number,reason:String},{_id:!1}),E=new i.Schema({orderId:{type:i.Schema.Types.ObjectId,ref:"Order"},items:[R],status:{type:String,enum:["requested","approved","rejected","received","refunded"],default:"requested"},refund:{amount:Number,method:{type:String,default:"original"}}},{timestamps:!0});i.models.Return||(0,i.model)("Return",E)},3947:(e,t,r)=>{"use strict";r.d(t,{D_:()=>s,Pq:()=>o,hS:()=>p,m_:()=>u,qQ:()=>d,v7:()=>a});var i=r(3022);class n extends Error{constructor(e,t=500,r){super(e),this.name=this.constructor.name,this.status=t,this.details=r}}class a extends n{constructor(e="Bad Request",t){super(e,400,t)}}class s extends n{constructor(e="Unauthorized",t){super(e,401,t)}}class d extends n{constructor(e="Forbidden",t){super(e,403,t)}}class u extends n{constructor(e="Not Found",t){super(e,404,t)}}function o(e,t={}){let r=t.status||200,i=new Headers(t.headers||void 0);return i.has("Content-Type")||i.set("Content-Type","application/json"),new Response(JSON.stringify(e),{status:r,headers:i})}function p(e){if(e instanceof i.G){let t=e instanceof i.G?new a("Validation error",e.issues.map(e=>({path:e.path.join("."),message:e.message,code:e.code}))):e;return o({error:t.message,details:t.details},{status:t.status})}return e instanceof n?o({error:e.message,details:e.details},{status:e.status}):e?.name==="JsonWebTokenError"?o({error:"Invalid token"},{status:401}):e?.name==="TokenExpiredError"?o({error:"Token expired"},{status:401}):(console.error("[API ERROR]",e),o({error:"Internal Server Error"},{status:500}))}},2171:(e,t,r)=>{"use strict";r.d(t,{nr:()=>d,zF:()=>s});var i=r(365);let n=process.env.JWT_SECRET,a=process.env.JWT_EXPIRES_IN||"7d";function s(e,t={}){return i.sign(e,n,{expiresIn:t.expiresIn||a})}function d(e){return i.verify(e,n)}n||console.warn("JWT_SECRET is not set. Set it in .env.local")}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),i=t.X(0,[79,388,365,255],()=>r(7588));module.exports=i})();