(()=>{var e={};e.id=616,e.ids=[616],e.modules={6037:e=>{"use strict";e.exports=require("mongoose")},846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},4870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},9428:e=>{"use strict";e.exports=require("buffer")},5511:e=>{"use strict";e.exports=require("crypto")},7910:e=>{"use strict";e.exports=require("stream")},8354:e=>{"use strict";e.exports=require("util")},2234:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>b,routeModule:()=>g,serverHooks:()=>f,workAsyncStorage:()=>S,workUnitAsyncStorage:()=>h});var n={};r.r(n),r.d(n,{DELETE:()=>y,GET:()=>m,PATCH:()=>l,runtime:()=>c});var i=r(1271),a=r(1232),s=r(8079),d=r(3418),u=r(9999),o=r(3947),p=r(5642);let c="nodejs";async function m(e,{params:t}){try{await (0,d.T)(),(0,p.ZT)();let e=await u.Yt.findById(t.id).lean();if(!e)throw new o.m_("Product not found");if(e.brand_id){let t=await u.mz.findById(e.brand_id).select("name slug").lean();e.brand=t||null}if(e.category_id){let t=await u.b7.findById(e.category_id).select("name slug").lean();e.category=t||null}return(0,o.Pq)({item:e})}catch(e){return(0,o.hS)(e)}}async function l(e,{params:t}){try{await (0,d.T)(),(0,p.ZT)();let r=await e.json(),n=await u.Yt.findByIdAndUpdate(t.id,{$set:r},{new:!0,runValidators:!0}).lean();if(!n)throw new o.m_("Product not found");return(0,o.Pq)({item:n})}catch(e){return(0,o.hS)(e)}}async function y(e,{params:t}){try{if(await (0,d.T)(),(0,p.ZT)(),!await u.Yt.findByIdAndDelete(t.id).lean())throw new o.m_("Product not found");return(0,o.Pq)({ok:!0})}catch(e){return(0,o.hS)(e)}}let g=new i.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/admin/products/[id]/route",pathname:"/api/admin/products/[id]",filename:"route",bundlePath:"app/api/admin/products/[id]/route"},resolvedPagePath:"C:\\Users\\imamb\\Desktop\\QuickCart\\apps\\backend\\app\\api\\admin\\products\\[id]\\route.js",nextConfigOutput:"",userland:n}),{workAsyncStorage:S,workUnitAsyncStorage:h,serverHooks:f}=g;function b(){return(0,s.patchFetch)({workAsyncStorage:S,workUnitAsyncStorage:h})}},7032:()=>{},408:()=>{},5642:(e,t,r)=>{"use strict";r.d(t,{JR:()=>d,ZT:()=>u});var n=r(255),i=r(2171),a=r(3947);async function s(){let e=await (0,n.UL)(),t=e.get("gt_auth")?.value;if(!t)throw new a.D_("Unauthorized");return(0,i.nr)(t)}async function d(){let e=await s();if(!e?.sub)throw new a.D_("Unauthorized");return e}async function u(){let e=await d();if(!(Array.isArray(e?.roles)?e.roles:[]).includes("admin"))throw new a.qQ("Forbidden");return e}},3418:(e,t,r)=>{"use strict";r.d(t,{T:()=>s});var n=r(6037);let i=process.env.MONGODB_URI||"mongodb://localhost:27017/GalaTech";if(console.log(i,"ini MONGODB_URI"),!i)throw Error("Please define the MONGODB_URI env var in .env.local");let a=global.mongoose;async function s(){return a.conn||(a.promise||(a.promise=n.connect(i,{bufferCommands:!1,dbName:process.env.MONGODB_DB,maxPoolSize:10}).then(e=>e)),a.conn=await a.promise),a.conn}a||(a=global.mongoose={conn:null,promise:null})},9999:(e,t,r)=>{"use strict";r.d(t,{mz:()=>u,Z3:()=>b,b7:()=>p,rI:()=>S,pH:()=>I,p2:()=>_,Yt:()=>y,p_:()=>j,KJ:()=>s,ar:()=>D});var n=r(6037);let i=new n.Schema({label:String,receiver_name:String,phone:String,street:String,subdistrict:String,city:String,province:String,postal_code:String,country:{type:String,default:"ID"},is_default:{type:Boolean,default:!1},geo:{lat:Number,lng:Number}},{_id:!0}),a=new n.Schema({email:{type:String,index:!0,unique:!0,sparse:!0},phone:{type:String,index:!0,unique:!0,sparse:!0},name:String,password_hash:String,roles:{type:[String],default:["customer"]},status:{type:String,enum:["active","blocked","deleted"],default:"active"},default_address_id:{type:n.Schema.Types.ObjectId},addresses:[i]},{timestamps:!0}),s=n.models.User||n.model("User",a),d=new n.Schema({slug:{type:String,unique:!0,index:!0},name:{type:String,required:!0},logo_url:String,logo_public_id:{type:String,default:""},country:String,status:{type:String,enum:["active","inactive"],default:"active"}},{timestamps:!0});d.index({name:"text"});let u=n.models.Brand||n.model("Brand",d),o=new n.Schema({slug:{type:String,unique:!0,index:!0},name:{type:String,required:!0},image:{type:String,required:!0},parent_id:{type:n.Schema.Types.ObjectId,ref:"Category",default:null},ancestors:[{_id:{type:n.Schema.Types.ObjectId,ref:"Category"},name:String,slug:String}],order:{type:Number,default:0}},{timestamps:!0});o.index({parent_id:1,order:1});let p=n.models.Category||n.model("Category",o),c=new n.Schema({url:String,alt:String},{_id:!1}),m=new n.Schema({sku:{type:String,index:!0,unique:!0},options:{type:n.Schema.Types.Mixed},price:{currency:{type:String,default:"IDR"},list:{type:Number,required:!0},sale:{type:Number,default:null},startAt:Date,endAt:Date},weightGram:Number,dimensionsCm:{l:Number,w:Number,h:Number},barcode:String,status:{type:String,enum:["active","inactive"],default:"active"}},{_id:!0}),l=new n.Schema({slug:{type:String,unique:!0,index:!0},sku:String,title:{type:String,required:!0},subtitle:String,brandId:{type:n.Schema.Types.ObjectId,ref:"Brand"},categoryIds:[{type:n.Schema.Types.ObjectId,ref:"Category"}],descriptionHtml:String,media:[c],attributes:n.Schema.Types.Mixed,variants:{type:[m],validate:e=>e.length>0},seo:{title:String,metaDescription:String},status:{type:String,enum:["active","draft","archived"],default:"active"},rating:{avg:{type:Number,default:0},count:{type:Number,default:0}},soldCount:{type:Number,default:0},viewCount:{type:Number,default:0}},{timestamps:!0});l.index({title:"text"}),l.index({brandId:1}),l.index({categoryIds:1}),l.index({status:1}),l.index({updatedAt:-1});let y=n.models.Product||(0,n.model)("Product",l),g=new n.Schema({product_id:{type:n.Schema.Types.ObjectId,ref:"Product",index:!0},variant_id:{type:n.Schema.Types.ObjectId,index:!0},warehouse_id:{type:String,default:"JKT-01"},on_hand:{type:Number,default:0},reserved:{type:Number,default:0}},{timestamps:!0});g.index({product_id:1,variant_id:1,warehouse_id:1},{unique:!0});let S=n.models.Inventory||n.model("Inventory",g),h=new n.Schema({productId:{type:n.Schema.Types.ObjectId,ref:"Product"},variantId:{type:n.Schema.Types.ObjectId},sku:String,title:String,variantLabel:String,qty:{type:Number,default:1},priceSnapshot:{currency:String,unit:Number},addedAt:{type:Date,default:Date.now}},{_id:!0}),f=new n.Schema({userId:{type:n.Schema.Types.ObjectId,ref:"User",index:!0},sessionId:{type:String,index:!0},items:[h],couponCodes:[String],notes:String},{timestamps:!0}),b=n.models.Cart||(0,n.model)("Cart",f),v=new n.Schema({productId:{type:n.Schema.Types.ObjectId,ref:"Product"},variantId:{type:n.Schema.Types.ObjectId},sku:String,title:String,variantLabel:String,qty:{type:Number,required:!0},price:{currency:{type:String,default:"IDR"},unit:{type:Number,required:!0},subtotal:{type:Number,required:!0}},weightGram:Number},{_id:!0}),x=new n.Schema({receiverName:String,phone:String,street:String,subdistrict:String,city:String,province:String,postalCode:String,country:String},{_id:!1}),w=new n.Schema({orderNo:{type:String,unique:!0,index:!0},userId:{type:n.Schema.Types.ObjectId,ref:"User",index:!0},status:{type:String,enum:["awaiting_payment","paid","processing","shipped","completed","cancelled","refunded"],default:"awaiting_payment"},channel:{type:String,default:"web"},items:[v],pricing:{subtotal:Number,discounts:[{code:String,amount:Number}],shippingCost:Number,tax:Number,grandTotal:Number},shippingAddress:x,billingAddress:x,payment:{paymentId:{type:n.Schema.Types.ObjectId,ref:"Payment"},method:String,status:{type:String,enum:["pending","paid","failed","expired"],default:"pending"}},shipment:{shipmentId:{type:n.Schema.Types.ObjectId,ref:"Shipment"},courier:String,service:String,trackingNo:String},placedAt:{type:Date,default:Date.now}},{timestamps:!0});w.index({userId:1,placedAt:-1}),w.index({status:1,placedAt:-1});let I=n.models.Order||(0,n.model)("Order",w),T=new n.Schema({orderId:{type:n.Schema.Types.ObjectId,ref:"Order",unique:!0},provider:String,method:String,amount:Number,currency:{type:String,default:"IDR"},status:{type:String,enum:["pending","paid","failed","expired","refunded"],default:"pending"},externalRef:{type:String,index:!0},vaNumber:String,paidAt:Date,raw:n.Schema.Types.Mixed},{timestamps:!0});T.index({status:1,createdAt:-1});let _=n.models.Payment||(0,n.model)("Payment",T),N=new n.Schema({status:String,at:Date},{_id:!1}),O=new n.Schema({orderId:{type:n.Schema.Types.ObjectId,ref:"Order",unique:!0},warehouseId:{type:String,default:"MAIN"},courier:String,service:String,trackingNo:{type:String,unique:!0,sparse:!0},status:{type:String,enum:["packed","shipped","in_transit","delivered","failed"],default:"packed"},history:[N]},{timestamps:!0});n.models.Shipment||(0,n.model)("Shipment",O);let q=new n.Schema({product_id:{type:n.Schema.Types.ObjectId,ref:"Product",index:!0},variant_id:{type:n.Schema.Types.ObjectId},order_id:{type:n.Schema.Types.ObjectId,ref:"Order"},user_id:{type:n.Schema.Types.ObjectId,ref:"User"},rating:{type:Number,min:1,max:5},title:String,content:String,media:[{url:String}],helpful_count:{type:Number,default:0},status:{type:String,enum:["pending","published","rejected"],default:"pending"}},{timestamps:!0});q.index({status:1,createdAt:-1});let j=n.models.Review||n.model("Review",q),A=new n.Schema({userId:{type:n.Schema.Types.ObjectId,ref:"User",unique:!0},items:[{productId:{type:n.Schema.Types.ObjectId,ref:"Product"},addedAt:{type:Date,default:Date.now}}]},{timestamps:!0}),D=n.models.Wishlist||(0,n.model)("Wishlist",A),k=new n.Schema({code:{type:String,unique:!0,index:!0},type:{type:String,enum:["flat","percent","shipping","bundle"],default:"flat"},value:Number,minOrder:{type:Number,default:0},maxDiscount:{type:Number,default:null},startAt:Date,endAt:Date,usageLimit:Number,usageCount:{type:Number,default:0},constraints:{brandIds:[n.Schema.Types.ObjectId],categoryIds:[n.Schema.Types.ObjectId],firstOrderOnly:{type:Boolean,default:!1}},status:{type:String,enum:["active","inactive"],default:"active"}},{timestamps:!0});k.index({status:1,startAt:1,endAt:1}),n.models.Coupon||(0,n.model)("Coupon",k);let P=new n.Schema({slot:{type:String,index:!0},title:String,imageUrl:String,linkUrl:String,startAt:Date,endAt:Date,priority:{type:Number,default:0},status:{type:String,enum:["active","inactive"],default:"active"}},{timestamps:!0});P.index({slot:1,status:1,startAt:1,endAt:1}),n.models.Banner||(0,n.model)("Banner",P);let C=new n.Schema({type:{type:String,index:!0},ref:{type:n.Schema.Types.Mixed},userId:{type:n.Schema.Types.ObjectId,ref:"User"},meta:n.Schema.Types.Mixed},{timestamps:{createdAt:!0,updatedAt:!1}});C.index({"ref.orderId":1,createdAt:-1}),C.index({createdAt:-1}),n.models.Event||(0,n.model)("Event",C);let R=new n.Schema({orderItemSku:String,qty:Number,reason:String},{_id:!1}),E=new n.Schema({orderId:{type:n.Schema.Types.ObjectId,ref:"Order"},items:[R],status:{type:String,enum:["requested","approved","rejected","received","refunded"],default:"requested"},refund:{amount:Number,method:{type:String,default:"original"}}},{timestamps:!0});n.models.Return||(0,n.model)("Return",E)},3947:(e,t,r)=>{"use strict";r.d(t,{D_:()=>s,Pq:()=>o,hS:()=>p,m_:()=>u,qQ:()=>d,v7:()=>a});var n=r(3022);class i extends Error{constructor(e,t=500,r){super(e),this.name=this.constructor.name,this.status=t,this.details=r}}class a extends i{constructor(e="Bad Request",t){super(e,400,t)}}class s extends i{constructor(e="Unauthorized",t){super(e,401,t)}}class d extends i{constructor(e="Forbidden",t){super(e,403,t)}}class u extends i{constructor(e="Not Found",t){super(e,404,t)}}function o(e,t={}){let r=t.status||200,n=new Headers(t.headers||void 0);return n.has("Content-Type")||n.set("Content-Type","application/json"),new Response(JSON.stringify(e),{status:r,headers:n})}function p(e){if(e instanceof n.G){let t=e instanceof n.G?new a("Validation error",e.issues.map(e=>({path:e.path.join("."),message:e.message,code:e.code}))):e;return o({error:t.message,details:t.details},{status:t.status})}return e instanceof i?o({error:e.message,details:e.details},{status:e.status}):e?.name==="JsonWebTokenError"?o({error:"Invalid token"},{status:401}):e?.name==="TokenExpiredError"?o({error:"Token expired"},{status:401}):(console.error("[API ERROR]",e),o({error:"Internal Server Error"},{status:500}))}},2171:(e,t,r)=>{"use strict";r.d(t,{nr:()=>d,zF:()=>s});var n=r(365);let i=process.env.JWT_SECRET,a=process.env.JWT_EXPIRES_IN||"7d";function s(e,t={}){return n.sign(e,i,{expiresIn:t.expiresIn||a})}function d(e){return n.verify(e,i)}i||console.warn("JWT_SECRET is not set. Set it in .env.local")}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[79,388,365,255],()=>r(2234));module.exports=n})();